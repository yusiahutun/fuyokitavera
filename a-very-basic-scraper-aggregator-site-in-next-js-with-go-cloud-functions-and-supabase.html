<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=description content="Wouldnt it be neat to have aggregated data (for a website, daily email, push alert, etc) of kids events in our surrounding area so we know about them right away? Thats proper nerd sniping on a Saturday morning a few weeks back when I didnt have too much else to do."><meta name=author content="Jenniffer Sheldon"><meta name=generator content="Hugo 0.98.0"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=robots content="index,follow,noarchive"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/base16/css/style.css type=text/css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type=text/css><link rel=alternate href=./index.xml type=application/rss+xml title=JadeVibe><title>A Very Basic Scraper/Aggregator Site in Next.js with Go Cloud Functions and Supabase Chris Coyie - JadeVibe</title></head><body><header><div class="container clearfix"><a class=path href=./index.html>[JadeVibe]</a>
<span class=caret># _</span><div class=right></div></div></header><div class=container><main role=main class=article><article class=single itemscope itemtype=http://schema.org/BlogPosting><div class=meta><span class=key>published on</span>
<span class=val><time itemprop=datePublished datetime=2024-08-25>August 25, 2024</time></span>
<span class=key>in</span>
<span class=val><a href=./categories/blog>blog</a></span></div><h1 class=headline itemprop=headline>A Very Basic Scraper/Aggregator Site in Next.js with Go Cloud Functions and Supabase Chris Coyie</h1><section class=body itemprop=articleBody><p>Wouldn‚Äôt it be neat to have aggregated data (for a website, daily email, push alert, etc) of kids events in our surrounding area so we know about them right away?</p>‚Äî My wife, possibly salty we missed out on Bluey Live tickets in Portland<p>That‚Äôs proper nerd sniping on a Saturday morning a few weeks back when I didn‚Äôt have too much else to do.</p><p>In the past, I‚Äôve been guilty of waving my hands at ideas that ‚Äújust‚Äù aggregate data from other websites. That‚Äôs just a scraper site, I‚Äôd think. Hit some websites, scrape what you need, chuck it in a database, and voila. This Saturday: OK ‚Äî big boy ‚Äî but you still gotta do it ‚Äî you think you got what it takes? üëÄ</p><p class="ticss-403ea660 has-black-color has-text-color has-background has-small-font-size">Wanna hear this talked about with mouthblogging? <a href=#>Dave and I chatted about it on ShopTalk.</a></p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=first-whats-going-to-do-the-scraping></a>First ‚Äî what‚Äôs going to do the scraping?</h3><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/Screenshot-2023-01-22-at-9.43.02-AM.png><p>I happened to have run across <a href=#>Colly</a> the other day.</p><p>This choice tickled me in three ways:</p><li>I get to use a scraper technology I‚Äôve never seen or used before.</li><li>It‚Äôs in Go, and I like opportunities to learn more Go, something I‚Äôve been investing time in learning for work.</li><li>I can try to make it work as a Netlify function because <a href=#>they support Go</a>, which is yet another learning opportunity.</li><p>So the very first thing I did was write the bare minimum Go code to verify the idea was feasible at all.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=the-scrapable-website></a>The Scrapable Website</h3><p><a href=#>This website</a>, as a first test, fortunately, is easily scrapable.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/CleanShot-2023-01-20-at-07.31.44@2x.png><p>Here‚Äôs the code to visit the website and pluck out the useful information:</p><pre class=wp-block-code aria-describedby=shcb-language-1 data-shcb-language-name=Go data-shcb-language-slug=go><span><code class="hljs language-go shcb-code-table shcb-wrap-lines"><span class=shcb-loc><span><span class=hljs-keyword>package</span> main </span></span><span class=shcb-loc><span> </span></span><span class=shcb-loc><span><span class=hljs-keyword>import</span> ( </span></span><span class=shcb-loc><span> <span class=hljs-string>"fmt"</span> </span></span><span class=shcb-loc><span> </span></span><span class=shcb-loc><span> <span class=hljs-string>"github.com/gocolly/colly"</span> </span></span><span class=shcb-loc><span>) </span></span><span class=shcb-loc><span> </span></span><span class=shcb-loc><span><span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>main</span><span class=hljs-params>()</span></span> { </span></span><span class=shcb-loc><span> c := colly.NewCollector( </span></span><span class=shcb-loc><span> colly.AllowedDomains(<span class=hljs-string>"www.portland5.com"</span>), </span></span><span class=shcb-loc><span> ) </span></span><span class=shcb-loc><span> </span></span><span> c.OnHTML(<span class=hljs-string>".views-row"</span>, <span class=hljs-function><span class=hljs-keyword>func</span><span class=hljs-params>(e *colly.HTMLElement)</span></span> { </span><span> titleText := e.ChildText(<span class=hljs-string>".views-field-title .field-content a"</span>) </span><span> </span><span> url := e.ChildAttr(<span class=hljs-string>".views-field-title .field-content a"</span>, <span class=hljs-string>"href"</span>) </span><span> </span><span> date := e.ChildAttr(<span class=hljs-string>".date-display-single"</span>, <span class=hljs-string>"content"</span>) </span><span> </span><span> venue := e.ChildText(<span class=hljs-string>".views-field-field-event-venue"</span>) </span><span class=shcb-loc><span> </span></span><span class=shcb-loc><span> fmt.Println(titleText, url, date, venue) </span></span><span class=shcb-loc><span> }) </span></span><span class=shcb-loc><span> </span></span><span class=shcb-loc><span> c.Visit(<span class=hljs-string>"https://www.portland5.com/event-types/kids"</span>) </span></span><span class=shcb-loc><span>} </span></span><span class=shcb-loc><span> </span></span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Go</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>go</span><span class=shcb-language__paren>)</span></pre><p>The above code was working for me, which was encouraging!</p><p class="ticss-8f7abfc5 has-black-color has-pale-pink-background-color has-text-color has-background has-small-font-size">Do websites owners care if we do this? I‚Äôm sure some do, where it is a competitive advantage thing for them for you to have to visit their website for information. Bandwidth costs and such probably aren‚Äôt much of a concern these days, unless you are really hammering them with requests. But in the case of this event scraper, I‚Äôd think they would be happy to spread the word about events.</p><p class="ticss-904e14a6 has-black-color has-luminous-vivid-amber-background-color has-text-color has-background has-small-font-size">The highlighted lines above are a real showcase of the fragility of this code. That‚Äôs the same as <code>document.querySelectorAll(".views-row .views-field-title .field-content a")</code>. Any little change on the parent site to the DOM and this code is toast.</p><p>Printing to standard out isn‚Äôt a particularly useful format and this code generally isn‚Äôt very usable. It‚Äôs not formatted as a cloud function and it‚Äôs not giving us the data in a format we can use.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=an-event-type></a>An Event Type</h3><p>This is the kind of data format that would be useful to have in Go:</p><pre class=wp-block-code aria-describedby=shcb-language-2 data-shcb-language-name=Go data-shcb-language-slug=go><span><code class="hljs language-go shcb-wrap-lines"><span class=hljs-keyword>type</span> KidsEvent <span class=hljs-keyword>struct</span> { ID <span class=hljs-keyword>int</span> <span class=hljs-string>`json:"id"`</span> Title <span class=hljs-keyword>string</span> <span class=hljs-string>`json:"title"`</span> URL <span class=hljs-keyword>string</span> <span class=hljs-string>`json:"url"`</span> Date <span class=hljs-keyword>string</span> <span class=hljs-string>`json:"date"`</span> Venue <span class=hljs-keyword>string</span> <span class=hljs-string>`json:"venue"`</span> Display <span class=hljs-keyword>bool</span> <span class=hljs-string>`json:"display"`</span> }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Go</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>go</span><span class=shcb-language__paren>)</span></pre><p>Once we have a <code>struct</code> like that, we can make a <code>[]KidsEvent</code> slice of them and <code>json.Marshal()</code> that into JSON. JSON is great to work with on the web, natch.</p><p>My next step was to have the cloud function do this scraping and return JSON data immediately.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=returning-json-from-a-go-cloud-function></a>Returning JSON from a Go Cloud Function</h3><p>That is structured like this, which will run on Netlify, which uses AWS Lambda under the hood:</p><pre class=wp-block-code aria-describedby=shcb-language-3 data-shcb-language-name=Go data-shcb-language-slug=go><span><code class="hljs language-go shcb-wrap-lines"><span class=hljs-keyword>package</span> main <span class=hljs-keyword>import</span> ( <span class=hljs-string>"context"</span> <span class=hljs-string>"encoding/json"</span> <span class=hljs-string>"log"</span> <span class=hljs-string>"github.com/aws/aws-lambda-go/events"</span> <span class=hljs-string>"github.com/aws/aws-lambda-go/lambda"</span> ) <span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>handler</span><span class=hljs-params>(ctx context.Context, request events.APIGatewayProxyRequest)</span> <span class=hljs-params>(*events.APIGatewayProxyResponse, error)</span></span> { kidsEvents, err := doTheScraping() <span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> { log.Fatal(err) } b, err := json.Marshal(kidsEvents) <span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> { log.Fatal(err) } <span class=hljs-keyword>return</span> &amp;events.APIGatewayProxyResponse{ StatusCode: <span class=hljs-number>200</span>, Headers: <span class=hljs-keyword>map</span>[<span class=hljs-keyword>string</span>]<span class=hljs-keyword>string</span>{<span class=hljs-string>"Content-Type"</span>: <span class=hljs-string>"text/json"</span>}, Body: <span class=hljs-keyword>string</span>(b), IsBase64Encoded: <span class=hljs-literal>false</span>, }, <span class=hljs-literal>nil</span> } <span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>main</span><span class=hljs-params>()</span></span> { lambda.Start(handler) }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Go</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>go</span><span class=shcb-language__paren>)</span></pre><p>Once this was working I was quite encouraged!</p><p>Getting it working was a bit tricky (because I‚Äôm a newb). <a href=#>You might want to see my public repo</a> if you want to do the same. It‚Äôs a little journey of making sure you‚Äôve got all the right files in place, like <code>go.mod</code> and <code>go.sum</code>, which are produced when you run the right terminal commands and do the correct <code>go get *</code> incantations. This is all so it builds correctly, and Netlify can do whatever it needs to do to make sure they work in production.</p><p>Fortunately, you can test this stuff locally. I would spin them up using the <a href=#>Netlify CLI </a>like:</p><pre class=wp-block-code aria-describedby=shcb-language-4 data-shcb-language-name=Bash data-shcb-language-slug=bash><span><code class="hljs language-bash">netlify <span class=hljs-built_in>functions</span>:serve</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Bash</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>bash</span><span class=shcb-language__paren>)</span></pre><p>Then hit the URL in the browser to invoke it like:</p><pre class=wp-block-preformatted>localhost:9999/.netlify/functions/scrape</pre><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/Screenshot-2023-01-22-at-9.25.46-AM.png><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=i-dont-actually-want-to-scrape-and-return-on-every-single-page-view-thats-wackadoo></a>I don‚Äôt actually want to scrape and return on every single page view, that‚Äôs wackadoo.</h3><p>It‚Äôs not very efficient and really not necessary. What I want to do is:</p><li>Scrape once in a while. Say, hourly or daily.</li><li>Save or cache the data somehow.</li><li>When the website is loaded (we‚Äôll get to building that soon), it loads the saved or cached data, it doesn‚Äôt always do a fresh scrape.</li><p>One thing that would be perfect for this is Netlify On Demand Builders. They run once, cache what they return, and only ever return that cache until they are specifically de-cached. That‚Äôs wonderful, and we could use that here‚Ä¶ except that Netlify doesn‚Äôt support On Demand builders with Go.</p><p class="ticss-63709a3d has-black-color has-very-light-gray-to-cyan-bluish-gray-gradient-background has-text-color has-background has-small-font-size">This is a moment where I might have gone: screw it, let‚Äôs make the cloud function in TypeScript or JavaScript. That would open the door to using On Demand builders, but also open the door to doing scraping with something like Puppeteer, which could scrape the real DOM of a website, not just the first HTML response. But in my case, I didn‚Äôt really care, I was playing and I wanted to play with Go.</p><p>So since we can‚Äôt use On Demand builders, let‚Äôs do it another way!</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=lets-keep-the-data-in-postgres></a>Let‚Äôs keep the data in Postgres</h3><p>We use Postgres at <a href=#>CodePen</a> so another opportunity to practice with tech used on a far more important project is nice. Where should I keep my little Postgres, though? Netlify doesn‚Äôt have any official integrations with a Postgres provider, I don‚Äôt think, but they are at least <a href=#>friendly</a> with <a href=#>Supabase</a>. Supabase has long appealed to me, so yet another opportunity here! Pretty much the whole point of Supabase is providing a Postgres with nice DX around it. Sold.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/CleanShot-2023-01-22-at-09.44.27@2x.png><p>I was assuming I was going to have to write a least a little SQL. But no ‚Äî&nbsp;setting up and manipulating the database can be entirely done with UI controls.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/Screenshot-2023-01-22-at-10.34.48-AM.png><p>But surely writing and reading from the DB requires some SQL? No again ‚Äî they have a variety of what they call ‚ÄúClient Libraries‚Äù (I think you‚Äôd call them <a href=#>ORMs</a>, generally) that help you connect and deal with the data through APIs that feel much more approachable, at least to someone like me. So we‚Äôll write code more like this than SQL:</p><pre class=wp-block-code aria-describedby=shcb-language-5 data-shcb-language-name=JavaScript data-shcb-language-slug=javascript><span><code class="hljs language-javascript"><span class=hljs-keyword>const</span> { error } = <span class=hljs-keyword>await</span> supabase .from(<span class=hljs-string>'countries'</span>) .update({ <span class=hljs-attr>name</span>: <span class=hljs-string>'Australia'</span> }) .eq(<span class=hljs-string>'id'</span>, <span class=hljs-number>1</span>)</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>JavaScript</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>javascript</span><span class=shcb-language__paren>)</span></pre><p>Unfortunately, Go, yet again isn‚Äôt a first-class citizen here. They have client libraries for JavaScript and Flutter and point you towards a userland Python library, but nothing for Go. Fortunately, a quick Google search turned up <a href=#>supabase-go</a>. So we‚Äôll be using it more like this:</p><pre class=wp-block-code aria-describedby=shcb-language-6 data-shcb-language-name=JavaScript data-shcb-language-slug=javascript><span><code class="hljs language-javascript">row := Country{ <span class=hljs-attr>ID</span>: <span class=hljs-number>5</span>, <span class=hljs-attr>Name</span>: <span class=hljs-string>"Germany"</span>, <span class=hljs-attr>Capital</span>: <span class=hljs-string>"Berlin"</span>, } <span class=hljs-keyword>var</span> results []Country <span class=hljs-attr>err</span> := supabase.DB.From(<span class=hljs-string>"countries"</span>).Insert(row).Execute(&amp;results) <span class=hljs-keyword>if</span> err != nil { panic(err) }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>JavaScript</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>javascript</span><span class=shcb-language__paren>)</span></pre><p>The goal is to have it mimic the official JavaScript client, so that‚Äôs good. It would feel better if it was official, but whattayagonnado.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=saving-and-actually-mostly-updating-to-supabase></a>Saving (and actually, mostly Updating) to Supabase</h3><p>I can‚Äôt just scrape the data and immediately append it to the database. What if a scraped event has already been saved there? In that case, we might as well just update the record that is already there. That takes care of the situation of event details changing (like the date or something) but otherwise being the same event. So the plan is:</p><li>Scrape the data</li><li>Loop over all events</li><li>Check the DB if they are already there</li><li>If they are, update that record</li><li>If they aren‚Äôt, insert a new record</li><pre class=wp-block-code aria-describedby=shcb-language-7 data-shcb-language-name=Go data-shcb-language-slug=go><span><code class="hljs language-go shcb-wrap-lines"><span class=hljs-keyword>package</span> main <span class=hljs-keyword>import</span> ( <span class=hljs-string>"fmt"</span> <span class=hljs-string>"os"</span> <span class=hljs-string>"github.com/google/uuid"</span> supa <span class=hljs-string>"github.com/nedpals/supabase-go"</span> ) <span class=hljs-function><span class=hljs-keyword>func</span> <span class=hljs-title>saveToDB</span><span class=hljs-params>(events []KidsEvent)</span> <span class=hljs-title>error</span></span> { supabaseUrl := os.Getenv(<span class=hljs-string>"SUPABASE_URL"</span>) supabaseKey := os.Getenv(<span class=hljs-string>"SUPABASE_API_KEY"</span>) supabase := supa.CreateClient(supabaseUrl, supabaseKey) <span class=hljs-keyword>for</span> _, event := <span class=hljs-keyword>range</span> events { result := KidsEvent{ Title: <span class=hljs-string>"No Match"</span>, } err := supabase.DB.From(<span class=hljs-string>"events"</span>).Select(<span class=hljs-string>"id, date, title, url, venue, display"</span>).Single().Eq(<span class=hljs-string>"title"</span>, event.Title).Execute(&amp;result) <span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> { fmt.Println(<span class=hljs-string>"Error!"</span>, err) } <span class=hljs-keyword>if</span> result.Title == <span class=hljs-string>"No Match"</span> { <span class=hljs-keyword>var</span> saveResults []KidsEvent event.ID = uuid.New().String() err := supabase.DB.From(<span class=hljs-string>"events"</span>).Insert(event).Execute(&amp;saveResults) <span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> { <span class=hljs-keyword>return</span> err } } <span class=hljs-keyword>else</span> { <span class=hljs-keyword>var</span> updateResults []KidsEvent err := supabase.DB.From(<span class=hljs-string>"events"</span>).Update(event).Eq(<span class=hljs-string>"title"</span>, event.Title).Execute(&amp;updateResults) <span class=hljs-keyword>if</span> err != <span class=hljs-literal>nil</span> { <span class=hljs-keyword>return</span> err } } } <span class=hljs-keyword>return</span> <span class=hljs-literal>nil</span> } </code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Go</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>go</span><span class=shcb-language__paren>)</span></pre><p>My newb-ness is fully displayed here, but at least this is functional. Notes:</p><li>I‚Äôm plucking those ENV variables from Netlify. I added them via the Netlify dashboard.</li><li>The ORM puts the data from the query into a variable you give it. So the way I‚Äôm checking if the query actually found anything is to make the struct variable have that ‚ÄúNo Match‚Äù title and check against that value after the query. Feels janky.</li><li>I‚Äôm checking for the uniqueness of the event by querying for the <code>url</code> which seems, ya know, unique. But the <code>.Eq()</code> I was doing would never find a matching event, and I couldn‚Äôt figure it out. Title worked.</li><li>The save-or-update logic otherwise works fine, but I‚Äôm sure there is a more logical and succinct way to perform that kind of action.</li><li>I‚Äôm making the ID of the event a UUID. I was so stumped at how you have to provide an ID for a record while inserting it. Shouldn‚Äôt it accept a <code>null</code> or whatever and auto-increment that? ü§∑‚Äç‚ôÄÔ∏è</li><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/CleanShot-2023-01-23-at-12.29.11@2x.png><p class="ticss-308c12c7 has-black-color has-luminous-vivid-amber-background-color has-text-color has-background has-small-font-size">The point of this experiment is to scrape from multiple websites. That is happening in the ‚Äúfinal‚Äù product, I just didn‚Äôt that up in this blog post. I made functions with the unique scraping code for each site and called them all in order, appending to the overall array. Now that I think about it, I wonder if a Go routine would quicken that up?</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=scheduling></a>Scheduling</h3><p>Netlify makes running cloud functions on a schedule stupid easy. Here‚Äôs the relevant bit of a <code>netlify.toml</code> file:</p><pre class=wp-block-code aria-describedby=shcb-language-8 data-shcb-language-name="TOML, also INI" data-shcb-language-slug=ini><span><code class="hljs language-ini"><span class=hljs-section>[functions]</span> <span class=hljs-attr>directory</span> = <span class=hljs-string>"functions/"</span> <span class=hljs-section>[functions."scrape"]</span> <span class=hljs-attr>schedule</span> = <span class=hljs-string>"@hourly"</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>TOML, also INI</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>ini</span><span class=shcb-language__paren>)</span></pre><p>JavaScript cloud functions have the benefit of an in-code way of declaring this information, which I prefer, so it‚Äôs another little jab at Go functions, but oh well, at least it‚Äôs possible.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=pulling-the-data-from-the-database></a>Pulling the data from the database</h3><p>This is the easy part for now. I query for every single event:</p><pre class=wp-block-code aria-describedby=shcb-language-9 data-shcb-language-name=JavaScript data-shcb-language-slug=javascript><span><code class="hljs language-javascript"><span class=hljs-keyword>var</span> results []KidsEvent <span class=hljs-attr>err</span> := supabase.DB.From(<span class=hljs-string>"events"</span>).Select(<span class=hljs-string>"*"</span>).Execute(&amp;results)</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>JavaScript</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>javascript</span><span class=shcb-language__paren>)</span></pre><p>Then turn that into JSON and return it, just like I was doing above when it returned JSON immediately after the scrape.</p><p>This could and should be a bit more complicated. For example, I should filter out past events. I should probably filter out the events with <code>Display</code> as <code>false</code> too. That was a thing where some scraped data was bogus, and rather than write really bespoke rules for the scraping, I‚Äôd flip the Boolean so I had something the avoid displaying it. I did that on the front end but it should be done in the back.</p><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=a-website></a>A Website</h3><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/Capture-2023-01-23-122700.png><p>I figured I‚Äôd go with <a href=#>Next.js</a>. Yet another thing we‚Äôre using at CodePen but I could use more experience with, particularly the very latest version. I figured I could do this the smart way by using <code><a href=https://nextjs.org/docs/basic-features/data-fetching/get-server-side-props>getServerSideProps</a></code> so a Node server would hit the cloud function, get the JSON data, and be able to render the HTML server side.</p><p>I spun it up in TypeScript too. Ya know, for the practice! This is pretty much the entire thing:</p><pre class=wp-block-code aria-describedby=shcb-language-10 data-shcb-language-name=JavaScript data-shcb-language-slug=javascript><span><code class="hljs language-javascript shcb-wrap-lines"><span class=hljs-keyword>export</span> <span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>getServerSideProps</span>(<span class=hljs-params></span>) </span>{ <span class=hljs-keyword>const</span> res = <span class=hljs-keyword>await</span> fetch( <span class=hljs-string>`<span class=hljs-subst>${process.env.SITE_URL}</span>/.netlify/functions/get-events`</span> ); <span class=hljs-keyword>const</span> data = <span class=hljs-keyword>await</span> res.json(); <span class=hljs-keyword>return</span> { <span class=hljs-attr>props</span>: { data } }; } type kidEvent = { <span class=hljs-attr>id</span>: string; title: string; date: string; display: boolean; url: string; venue: string; }; <span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>Home</span>(<span class=hljs-params>props: { data: kidEvent[] }</span>) </span>{ <span class=hljs-keyword>return</span> ( <span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>main</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>h1</span>&gt;</span>Kids Events<span class=hljs-tag>&lt;/<span class=hljs-name>h1</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>div</span>&gt;</span> {props.data.map((event) =&gt; { const date = new Date(event.date).toDateString(); if (event.display === false) return null; return ( <span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>key</span>=<span class=hljs-string>{event.id}</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dl</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dt</span>&gt;</span>Title<span class=hljs-tag>&lt;/<span class=hljs-name>dt</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dd</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>h3</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>a</span> <span class=hljs-attr>href</span>=<span class=hljs-string>{event.url}</span>&gt;</span>{event.title}<span class=hljs-tag>&lt;/<span class=hljs-name>a</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>h3</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>dd</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dt</span>&gt;</span>Date<span class=hljs-tag>&lt;/<span class=hljs-name>dt</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dd</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>time</span>&gt;</span>{date}<span class=hljs-tag>&lt;/<span class=hljs-name>time</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>dd</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dt</span>&gt;</span>Venue<span class=hljs-tag>&lt;/<span class=hljs-name>dt</span>&gt;</span> <span class=hljs-tag>&lt;<span class=hljs-name>dd</span>&gt;</span>{event.venue}<span class=hljs-tag>&lt;/<span class=hljs-name>dd</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>dl</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>div</span>&gt;</span> ); })} <span class=hljs-tag>&lt;/<span class=hljs-name>div</span>&gt;</span> <span class=hljs-tag>&lt;/<span class=hljs-name>main</span>&gt;</span></span> ); }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>JavaScript</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>javascript</span><span class=shcb-language__paren>)</span></pre><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/CleanShot-2023-01-23-at-13.16.59@2x.png><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=styling></a>Styling</h3><p>I kinda love styling stuff in Next.js. It supports CSS modules out of the box, and Sass is as easy as <code>npm install sass</code>. So I can make files like <code>Home.module.scss</code> for individual components, and use the scoped styles. It‚Äôs a smidge heavy on CSS tooling, but I admit I find this particular alchemy pleasing.</p><pre class=wp-block-code aria-describedby=shcb-language-11 data-shcb-language-name=JavaScript data-shcb-language-slug=javascript><span><code class="hljs language-javascript"><span class=hljs-keyword>import</span> styles <span class=hljs-keyword>from</span> <span class=hljs-string>"../styles/Home.module.scss"</span>; <span class=hljs-keyword>export</span> <span class=hljs-keyword>default</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>Home</span>(<span class=hljs-params></span>) </span>{ <span class=hljs-keyword>return</span>( <span class=xml><span class=hljs-tag>&lt;<span class=hljs-name>main</span> <span class=hljs-attr>className</span>=<span class=hljs-string>{styles.main}</span> &lt;/<span class=hljs-attr>main</span>&gt;</span></span> ); }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>JavaScript</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>javascript</span><span class=shcb-language__paren>)</span></pre><p>I also took the opportunity to use <a href=#>Open Props</a> for the values of as much as I possibly could. That leads to this kind of thing:</p><pre class=wp-block-code aria-describedby=shcb-language-12 data-shcb-language-name=CSS data-shcb-language-slug=css><span><code class="hljs language-css"><span class=hljs-selector-class>.card</span> { <span class=hljs-attribute>padding</span>: <span class=hljs-built_in>var</span>(--size-<span class=hljs-number>5</span>); <span class=hljs-attribute>background</span>: <span class=hljs-built_in>var</span>(--gray-<span class=hljs-number>1</span>); <span class=hljs-attribute>color</span>: <span class=hljs-built_in>var</span>(--gray-<span class=hljs-number>9</span>); <span class=hljs-attribute>box-shadow</span>: <span class=hljs-built_in>var</span>(--shadow-<span class=hljs-number>3</span>); <span class=hljs-attribute>border-radius</span>: <span class=hljs-built_in>var</span>(--radius-<span class=hljs-number>3</span>); }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>CSS</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>css</span><span class=shcb-language__paren>)</span></pre><p>I found Open Props very nice to use, but I kinda wish it were somehow ‚Äútyped‚Äù in that it would help me discover and use the correct variables and show me what the values are right within VS Code.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2023/01/Screenshot-2023-01-23-at-12.30.16-PM.png><h3 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=pittered-out></a>Pittered Out</h3><p>The very basics of this thing are working and <a href=#>I published it</a>. I‚Äôm not sure I‚Äôd even call this a minimum viable prototype since it has so many rough edges. It doesn‚Äôt deal with any date complexities like events that run multiple days or even expiring past events. It scrapes from a few sites, but only one of them is particularly interesting, so I haven‚Äôt even proven that there are enough places to make this an interesting scraping job. It doesn‚Äôt send alerts or be helpful in any way my wife originally envisioned.</p><p>But it did teach me some things and I had fun doing it. Maybe another full day, and it could be in decent enough shape to use, but my energy for it is gone for now. As quickly as a nerd sniping can come on, it comes off.</p><p><h3 class=jp-relatedposts-headline>Related</h3></p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmibmKe2tK%2FOsqCeql6jsrV7kWlpbGdgZnxzf46aZK%2Bdoq56o63Soppmq5OnrrGx0WaYoJ%2BimrSiwM6rZKyhpJp6qrqMp5yxrF2fwG7DyK2fZp%2BfYrCtu9SdZJ%2BtnpjBqrvNrGSappRiwLa8wJuYrJ1f</p></section></article></main></div><footer><div class=container><span class=copyright>&copy; 2024 JadeVibe - <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a></span></div></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>